. (Join-Path $PSScriptRoot 'helpers' 'TestHelpers.ps1')

Describe 'Setup Directories Tests' {
    BeforeAll {
        # Setup test environment - modules loaded by TestHelpers.ps1
        $script:ScriptPath = Get-RunnerScriptPath '0002_Setup-Directories.ps1'
    }

    Context 'Directory Creation' {
        It 'creates directories when the script runs' {
            $hv  = Join-Path $TestDrive 'hyperv'
            $iso = Join-Path $TestDrive 'iso'
            $cfg = [pscustomobject]@{ Directories = @{ HyperVPath = $hv; IsoSharePath = $iso } }
            & $script:ScriptPath -Config $cfg
            (Test-Path $hv)  | Should -BeTrue
            (Test-Path $iso) | Should -BeTrue
        }

        It 'handles existing directories gracefully' {
            $hv  = Join-Path $TestDrive 'hyperv'
            $iso = Join-Path $TestDrive 'iso'
            New-Item -ItemType Directory -Path $hv  | Out-Null
            New-Item -ItemType Directory -Path $iso | Out-Null
            $cfg = [pscustomobject]@{ Directories = @{ HyperVPath = $hv; IsoSharePath = $iso } }
            { & $script:ScriptPath -Config $cfg } | Should -Not -Throw
            (Test-Path $hv)  | Should -BeTrue
            (Test-Path $iso) | Should -BeTrue
        }
    }
}




